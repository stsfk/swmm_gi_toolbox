<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>example1.utf8</title>

<script src="site_libs/header-attrs-2.1/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SWMM-GI coupling tool</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="example1.html">Exampe 1</a>
</li>
<li>
  <a href="example2.html">Exampe 2</a>
</li>
<li>
  <a href="example3.html">Exampe 3</a>
</li>
<li>
  <a href="example4.html">Exampe 4</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="example-1-model-green-roofs-interally-and-externally-using-swmm" class="section level2">
<h2>Example 1 Model green roofs interally and externally using SWMM</h2>
<p>In this example, the hydrological performance of green roofs in a simple catchment is examined. The green roofs are first modeled externally using the SWMM’s green roof module, and then the resulted hydrograph is coupled with the SWMM catchment model using the functions provided by the toolbox. The result is then compared to that obtained by modeling green roofs internally using SWMM. The results of two cases are expected to be the same, as the toolbox is designed to update the parameters to accommodate the external modeling of green roofs and the same green roof model is used in both cases. The simulations are driven by a 60 mm SCS type III 24-hr design storm.</p>
<div id="original-catchment-without-green-roofs" class="section level3">
<h3>1. Original catchment without green roofs</h3>
<p>The paramater of the original subcatchment before installing green roofs is stored in <em>raw_catchment.inp</em>. The modeled catchment only has a 0.5 acre impervious catchemnt, which drains runoffs from the catchment to the out. The catchment can be ploted by executing the code chunk that uses functions provided by swmmr.</p>
<pre class="r"><code># Load toolbox functions
source(&quot;interface_functions.R&quot;)

inp &lt;- read_inp(&quot;./example/example1/raw_catchment.inp&quot;)

# Functions provided in swmmr are used for visulization
sub_sf &lt;- subcatchments_to_sf(inp)
lin_sf &lt;- links_to_sf(inp)
jun_sf &lt;- junctions_to_sf(inp)
rg_sf &lt;- raingages_to_sf(inp)

lab_coord &lt;- sub_sf %&gt;% 
  sf::st_centroid() %&gt;%
  sf::st_coordinates() %&gt;% 
  tibble::as_tibble()

lab_rg_coord &lt;- rg_sf %&gt;% 
  {sf::st_coordinates(.) + 500} %&gt;% # add offset
  tibble::as_tibble()

sub_sf &lt;- dplyr::bind_cols(sub_sf, lab_coord)
rg_sf &lt;- dplyr::bind_cols(rg_sf, lab_rg_coord)

ggplot() + 
  # first plot the subcatchment and colour continously by Area
  geom_sf(data = sub_sf, aes(fill = Perc_Imperv), color = &quot;black&quot;, alpha = 0.8) + 
  scale_fill_gradient(low = &quot;lightgreen&quot;, high = &quot;indianred4&quot;) +
  geom_sf(data = lin_sf, colour = &quot;blue&quot;, size = 1) +
  geom_sf(data = jun_sf, colour = &quot;grey20&quot;, size = 2) +
  geom_label(data = sub_sf, aes(X, Y, label = Name), size = 3) +
  labs(x = &quot;x-axis&quot;,
       y = &quot;y-axis&quot;,
       fill = &quot;Imperviousness\n(%)&quot;) +
  scale_fill_gradient(limits = c(0,100), low = &quot;#009E73&quot;, high = &quot;#D16103&quot;) +
  theme_bw(base_size = 10)</code></pre>
<p><img src="example1_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The <code>run_swmm</code> function provided by swmmr is used execute SWMM simulation. The outflow is store in <em>test.txt</em> in the current the current working directory, and is stored in the <code>raw_outflow</code> variable using the <code>read_outflow</code> function as defined in the code chunk below.</p>
<pre class="r"><code>run_swmm(&quot;./example/example1/raw_catchment.inp&quot;)

read_outflow &lt;- function(fpath = &quot;outflow.txt&quot;){
  # Purpose: read simulated outflow hydrograph
  # Input: 
  #    fpath = file path of the simulated outflow, which is defined in the [FILES] tabe in SWMM input file
  # Output:
  #    a tibble stores the outflow hydrograph
  
  read_table(fpath, skip = 7) %&gt;%
    transmute(datetime = ymd_hms(paste(Year, Mon, Day, Hr, Min, Sec)),
            flow = FLOW) %&gt;%
    arrange(datetime)
}

raw_outflow &lt;- read_outflow()</code></pre>
</div>
<div id="green-roofs-modeled-using-swmms-green-roof-module" class="section level3">
<h3>2. Green roofs modeled using SWMM’s green roof module</h3>
<p>Assume the green roofs have a surface area of 0.25 acre (i.e., half of the catchment area). The SWMM model for the green roofs is <em>SWMM_green_roof.inp</em>. The outflow hydrograph from green roofs can be obtained using the <code>run_swmm</code> and <code>read_outflow</code> function.</p>
<pre class="r"><code>run_swmm(&quot;./example/example1/SWMM_green_roof.inp&quot;)
SWMM_green_roof_outflow &lt;- read_outflow()</code></pre>
<p>The hydrograph is then save in <em>GR_outflow.txt</em> using <code>write_csv</code>, and is later used as input flows to SWMM.</p>
<pre class="r"><code>fname = &quot;./example/example1/GR_outflow.txt&quot;
write_csv(SWMM_green_roof_outflow, path = fname)</code></pre>
</div>
<div id="catchment-with-green-roofs-modeled-using-swmms-green-roof-module" class="section level3">
<h3>3. Catchment with green roofs modeled using SWMM’s green roof module</h3>
<p>The catchment with green roofs is modeled using SWMM. The model is stored in <em>SWMM_catchment_w_GR.inp</em>. The simulation can be execuated using the following code chunk. The simulated outflow is stored in the <code>SWMM_catchment_w_GR_outflow</code> varible.</p>
<pre class="r"><code>run_swmm(&quot;./example/example1/SWMM_catchment_w_GR.inp&quot;)
SWMM_catchment_w_GR_outflow &lt;- read_outflow()</code></pre>
</div>
<div id="incorporating-externally-modeled-green-roof-hydrograph-into-swmm-simulation" class="section level3">
<h3>4. Incorporating externally-modeled green roof hydrograph into SWMM simulation</h3>
<p>The information the toolbox needed for coupling <em>GR_outflow.txt</em> and <em>raw_catchment.inp</em> is stored in the file <em>GI_plan.csv</em>. It can be read using the <code>read_GI_plan</code> function in the toolbox.</p>
<pre class="r"><code>GI_plan &lt;- read_GI_plan(&quot;./example/example1/GI_plan.csv&quot;)

print(GI_plan)</code></pre>
<pre><code>## # A tibble: 1 x 6
##   inflow_path                                                             outlet subcatchment_name per_area_rep imp_area_rep width_adj
##   &lt;chr&gt;                                                                   &lt;chr&gt;  &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
## 1 C:/Users/User/Documents/swmm_gi_toolbox/example/example1/GR_outflow.txt 0      S1                           0         0.25       115</code></pre>
<p>Six variables are defined.</p>
<ol style="list-style-type: decimal">
<li><em>inflow_path</em>: the path of the file that stores the outflow hydrograph from GI. The hydrograph will be used as input flows to SWMM.</li>
<li><em>outlet</em>: the node or the subcatchment that receives the inflow. <em>0</em> means the same outlet as the subcatchment is used.</li>
<li><em>subcatchment_name</em>: the name of the subcatchment, where GIs are installed.</li>
<li><em>per_area_rep</em>: pervious area represented by the inflow hydrograph, i.e., the pervious area modeled externally.</li>
<li><em>imp_area_rep</em>: impervious area represented by the inflow hydrograph, i.e., the impervious area modeled externally.</li>
<li><em>width_adj</em>: the subcatchment width parameter after modeled GIs externally. <em>0</em> means no change to subcatchment width.</li>
</ol>
<p>The outflow hydrograph are imported to SWMM using routing interface files. The interface file can be created using the <code>write_routing_interface_file</code> function provided by the toolbox.</p>
<pre class="r"><code># read the SWMM input file of the original catchment using swmmr::read_inp
inp &lt;- read_inp(&quot;./example/example1/raw_catchment.inp&quot;)

# write routing interface file
routing_interface_path &lt;- &quot;./example/example1/routing_interface.txt&quot;
write_routing_interface_file(GI_plan, inp, routing_interface_path)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p><code>write_routing_interface_file</code> returns <em>TRUE</em> is the routing interface is created successfully. <code>write_routing_interface_file</code> takes three arguments.</p>
<ol style="list-style-type: decimal">
<li><em>GI_plan</em>: the tibble that stores the information needed for creating routing interface file; it is output of the <code>read_GI_plan</code> function. See explanations for <code>read_GI_plan</code> above.</li>
<li><em>inp</em>: the object that corresponds to input file read by <code>swmmr::read_inp</code>.</li>
<li><em>routing_interface_path</em>: the file path of the routing interface file to be created.</li>
</ol>
<p>SWMM input file needs to be modified to accommodate the external modeling of green roofs. The <code>modify_inp</code> function provided by the toolbox can modify the <em>inp</em> object of the original catchment according to <em>GI_plan</em>.</p>
<pre class="r"><code>new_inp &lt;- modify_inp(GI_plan, inp, routing_interface_path)</code></pre>
<p><code>modify_inp</code> returns the <em>inp</em> object correspond to the catchment after GIs are modeled externally. It takes three arguments, which are the same as in the <code>write_routing_interface_file</code> function. See explanations above.</p>
<p>The modified SWMM input file can then created and execuated using the <code>write_inp</code> and <code>run_swmm</code> fucntions provided by swmmr.</p>
<pre class="r"><code># write new input file
write_inp(new_inp, file = &quot;./example/example1/test.inp&quot;)
# run simulation
run_swmm(&quot;./example/example1/test.inp&quot;)
# read outflow hydrograph
coupled_outflow &lt;- read_outflow()</code></pre>
</div>
<div id="compare-the-results-of-model-green-roofs-externally-and-interanlly-using-swmm" class="section level3">
<h3>5. Compare the results of model green roofs externally and interanlly using SWMM</h3>
<p>The two simulated outflow hydrographs, <em>SWMM_catchment_w_GR_outflow</em> and <em>coupled_outflow</em>, are supposed to be the same. The following code chunk produces a figure that compares the hydrographs of the original catchment and the catchment with green roofs modeled internally and externally.</p>
<pre class="r"><code># create a tibble that stores the outflow hydrographs of three cases
# convert to long form for ploting
hydrographs &lt;- tibble(
  datetime = raw_outflow$datetime,
  original = raw_outflow$flow,
  internal = SWMM_catchment_w_GR_outflow$flow,
  external = coupled_outflow$flow) %&gt;%
  gather(case, value, -datetime) %&gt;%
  mutate(case = factor(case, levels = c(&quot;original&quot;, &quot;internal&quot;, &quot;external&quot;))) %&gt;%
  filter(datetime &lt;= ymd_hm(&quot;2020-06-02 00:00&quot;))

# plot in the same figure, different cases are map to different colors and linetypes
ggplot(hydrographs, aes(datetime, value, linetype = case, color = case)) +
  geom_line(size = 0.65) +
  scale_color_manual(values = c(&quot;grey&quot;, &quot;tomato3&quot;, &quot;turquoise3&quot;)) +
  scale_linetype_manual(values = c(&quot;dashed&quot;, &quot;solid&quot;, &quot;dotdash&quot;))+
  labs(x = &quot;Time&quot;,
       y = &quot;Flow rate [CFS]&quot;) +
  theme_classic(base_size = 12) +
  theme(legend.position = c(1,1),
        legend.justification = c(1,1),
        legend.key.width = unit(1.5, &quot;cm&quot;))</code></pre>
<p><img src="example1_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>As expected, the hydrographs obtained for internal and external modeling cases are almost the same. This confirms the code worked as expected, i.e., the externally modeled outflow from green roofs are correctly written into the routing interface file, and the SWMM model parameters are correctly adjusted to represented the catchment areas without green roofs.</p>
<p>The difference in peak flow of the two modeling methods is -0.003 CFS, or -0.309%, and in runoff volume is -0.5 cubic feet, or -0.014%. The very small differences are mainly caused by rounding error in computation and file processing.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
